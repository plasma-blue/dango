:root {
    /* ğŸŒ Light Mode */
    --bg-color: #f8f9fa;
    --dot-color: #cbd5e1;

    --ui-bg: rgba(255, 255, 255, 0.85);
    --ui-border: rgba(255, 255, 255, 0.8);
    --ui-shadow: 0 8px 32px rgba(31, 38, 135, 0.08);
    --ui-text: #334155;
    --ui-text-dim: #64748b;
    --ui-hover-bg: rgba(0, 0, 0, 0.04);
    --ui-selection-bg: rgba(37, 130, 146, 0.1);

    --logo-gradient: linear-gradient(135deg, #258292 0%, #1a6b78 100%);
    --logo-text: #ffffff;

    --node-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    --node-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

    --select-color: #258292;
    --group-bg: rgba(37, 130, 146, 0.05);
    --group-border: #258292;
    --link-color: #94a3b8;

    /* èŠ‚ç‚¹é…è‰² */
    --c-white-bg: #ffffff;
    --c-white-border: #e2e8f0;
    --c-white-text: #1e293b;

    --c-red-bg: #fee2e2;
    --c-red-border: #fecaca;
    --c-red-text: #991b1b;
    --c-yellow-bg: #fef3c7;
    --c-yellow-border: #fde68a;
    --c-yellow-text: #92400e;
    --c-green-bg: #d1fae5;
    --c-green-border: #a7f3d0;
    --c-green-text: #065f46;
    --c-blue-bg: #e0e7ff;
    --c-blue-border: #c7d2fe;
    --c-blue-text: #3730a3;
    --c-orange-bg: #ffedd5;
    --c-orange-border: #fed7aa;
    --c-orange-text: #9a3412;
    --c-purple-bg: #f3e8ff;
    --c-purple-border: #d8b4fe;
    --c-purple-text: #6b21a8;
    --c-pink-bg: #fce7f3;
    --c-pink-border: #fbcfe8;
    --c-pink-text: #9d174d;
    --c-cyan-bg: #cffafe;
    --c-cyan-border: #a5f3fc;
    --c-cyan-text: #155e75;

    --c-danger: #ef4444;
    --c-danger-text: #ffffff;
    --text-selection-bg: rgba(37, 130, 146, 0.3); /* ç¨å¾®é€æ˜çš„ --select-color */
}

/* ğŸŒ™ Dark Mode */
[data-theme="dark"] {
    --bg-color: #111827;
    --dot-color: #374151;

    --ui-bg: rgba(31, 41, 55, 0.85);
    --ui-border: rgba(255, 255, 255, 0.05);
    --ui-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    --ui-text: #f1f5f9;
    --ui-text-dim: #94a3b8;
    --ui-hover-bg: rgba(255, 255, 255, 0.1);

    --logo-gradient: linear-gradient(135deg, #38b2ac 0%, #258292 100%);

    --node-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    --node-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.4);

    --select-color: #38b2ac;
    --group-bg: rgba(56, 178, 172, 0.1);
    --group-border: #258292;
    --link-color: #64748b;

    --c-white-bg: #1f2937;
    --c-white-border: #374151;
    --c-white-text: #f3f4f6;
    --c-red-bg: #450a0a;
    --c-red-border: #7f1d1d;
    --c-red-text: #fecaca;
    --c-yellow-bg: #451a03;
    --c-yellow-border: #78350f;
    --c-yellow-text: #fde68a;
    --c-green-bg: #064e3b;
    --c-green-border: #065f46;
    --c-green-text: #a7f3d0;
    --c-blue-bg: #1e1b4b;
    --c-blue-border: #312e81;
    --c-blue-text: #c7d2fe;
    --c-orange-bg: #431407;
    --c-orange-border: #7c2d12;
    --c-orange-text: #fdba74;
    --c-purple-bg: #3b0764;
    --c-purple-border: #6b21a8;
    --c-purple-text: #d8b4fe;
    --c-pink-bg: #500724;
    --c-pink-border: #831843;
    --c-pink-text: #fbcfe8;
    --c-cyan-bg: #083344;
    --c-cyan-border: #164e63;
    --c-cyan-text: #67e8f9;
    --text-selection-bg: rgba(56, 178, 172, 0.4);
}

/* --- å…¨å±€æ–‡æœ¬é«˜äº®ä¼˜åŒ– --- */
::selection {
    background-color: var(--text-selection-bg);
    color: inherit;
}

/* é’ˆå¯¹èŠ‚ç‚¹ç¼–è¾‘æ—¶çš„ç‰¹å®šå¤„ç† */
.node.editing::selection {
    background-color: var(--text-selection-bg);
}

/* ç¡®ä¿ textarea ä¹Ÿéµå¾ªåŒæ ·çš„é£æ ¼ */
textarea::selection {
    background-color: var(--text-selection-bg);
}

body,
html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: var(--bg-color);
    background-image: radial-gradient(var(--dot-color) 1.5px, transparent 1.5px);
    background-size: 24px 24px;
    color: var(--ui-text);
    user-select: none;
    transition: background-color 0.3s, color 0.3s;
}

body.mode-space {
    cursor: grab;
}

body.mode-pan {
    cursor: grabbing;
}

body.mode-space * {
    cursor: grab !important;
}

body.mode-pan * {
    cursor: grabbing !important;
}

/* --- UI Panel --- */
#ui-layer {
    position: absolute;
    top: 24px;
    left: 24px;
    z-index: 1000;
    /* æ”¶èµ·çŠ¶æ€ */
    width: 48px;
    height: 48px;

    border-radius: 14px;
    background: var(--ui-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--ui-border);
    box-shadow: var(--ui-shadow);
    overflow: visible;
    display: flex;
    flex-direction: column;
    color: var(--ui-text);

    transition:
        width 0.3s cubic-bezier(0.16, 1, 0.3, 1) 0.15s,
        height 0.3s cubic-bezier(0.16, 1, 0.3, 1) 0.15s,
        border-radius 0.3s;
}

#ui-layer:hover,
#ui-layer:focus-within {
    width: 340px;
    height: auto;
    border-radius: 18px;
    transition:
        width 0.3s cubic-bezier(0.16, 1, 0.3, 1) 0s,
        height 0.3s cubic-bezier(0.16, 1, 0.3, 1) 0s;
}

/* âœ¨ æ–°å¢ï¼šç§»åŠ¨ç«¯æ¿€æ´»çŠ¶æ€ (æ— åŠ¨ç”»ï¼Œé˜²æ­¢å¸ƒå±€å´©å) */
#ui-layer.mobile-active {
    width: 340px;
    height: auto;
    border-radius: 18px;
    /* å…³é”®ï¼šå–æ¶ˆè¿‡æ¸¡ï¼Œç›´æ¥ç¬å¼€ */
    transition: none !important; 
}

/* é¡¶éƒ¨æ å®¹å™¨ */
#ui-top-bar {
    height: 48px;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 0 6px;
    /* å¾®è°ƒå†…è¾¹è· */
    box-sizing: border-box;
}

/* âœ¨ Logo åŒºåŸŸ - é‡æ–°è®¾è®¡ */
#ui-logo-box {
    width: 36px;
    height: 36px;
    /* border-radius: 10px;
    background: var(--logo-gradient); */
    display: flex;
    align-items: center;
    justify-content: center;
    /* color: var(--logo-text); */
    font-size: 18px;
    flex-shrink: 0;
    /* box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3); */
    /* é»˜è®¤åœ¨å·¦ä¸Šè§’ */
}

/* æ ‡é¢˜å’ŒæŒ‰é’®å®¹å™¨ */
#ui-header-content {
    display: flex;
    align-items: center;
    flex-grow: 1;
    overflow: visible;
    opacity: 0;
    pointer-events: none;
    margin-left: 12px;
    transition: opacity 0.15s ease-out 0s;
}

#ui-layer:hover #ui-header-content,
#ui-layer:focus-within #ui-header-content {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0.3s ease-out 0.2s;
}

#ui-layer.mobile-active #ui-header-content {
    opacity: 1;
    pointer-events: auto;
    transition: none !important; /* ç§»åŠ¨ç«¯ç¬ç° */
}


#ui-layer:hover #ui-content,
#ui-layer:focus-within #ui-content {
    opacity: 1;
    height: auto;
    overflow: visible;
    transition: opacity 0.3s ease-out 0.2s;
}

#ui-layer.mobile-active #ui-content {
    opacity: 1;
    height: auto;
    overflow: visible;
    transition: none !important; /* ç§»åŠ¨ç«¯ç¬ç° */
}

/* Title - é‡æ–°è®¾è®¡ */
#ui-title {
    font-weight: 700;
    font-size: 15px;
    flex-grow: 1;
    white-space: nowrap;
    letter-spacing: -0.02em;
    color: var(--ui-text);
}

/* é¡¶éƒ¨åŠŸèƒ½æŒ‰é’® (Theme & Help) - é‡æ–°è®¾è®¡ */
.header-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: none;
    background: transparent;
    color: var(--ui-text-dim);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    margin-left: 4px;
    position: relative;
    /* For tooltip positioning */
}

.header-btn svg {
    width: 18px;
    height: 18px;
    fill: none;
    stroke: currentColor;
}

.header-btn:hover {
    background: var(--ui-hover-bg);
    color: var(--ui-text);
}

.header-btn.active {
    background: var(--select-color);
    color: white;
}

/* å†…å®¹åŒºåŸŸ */
#ui-content {
    padding: 0 16px 16px 16px;
    opacity: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
    transition: opacity 0.15s ease-out 0s;
    overflow: hidden;
    height: 0;
    /* æ”¶èµ·æ—¶é«˜åº¦ä¸º0ï¼Œé˜²æ­¢æ’‘å¼€ */
}

#ui-layer:hover #ui-content,
#ui-layer:focus-within #ui-content {
    opacity: 1;
    height: auto;
    overflow: visible;
    transition: opacity 0.3s ease-out 0.2s;
}

textarea {
    width: 100%;
    height: 80px;
    resize: none;
    border: 1px solid var(--dot-color);
    border-radius: 10px;
    padding: 12px;
    font-family: inherit;
    font-size: 14px;
    background: rgba(255, 255, 255, 0.05);
    color: inherit;
    outline: none;
    box-sizing: border-box;
    transition: border-color 0.2s, background-color 0.2s;
    line-height: 1.5;
}

textarea:focus {
    border-color: var(--select-color);
    background: var(--bg-color);
}

.btn-row {
    display: flex;
    gap: 10px;
    align-items: stretch;
    /* ç¡®ä¿æ‰€æœ‰å…ƒç´ é«˜åº¦ä¸€è‡´ */
}

#export-container,
#btn-import,
#btn-clear {
    flex: 1;
    min-width: 0;
    /* é˜²æ­¢æº¢å‡º */
}

/* ç»Ÿä¸€å†…éƒ¨æŒ‰é’®æ ·å¼ */
.btn-row button.secondary {
    width: 100%;
    height: 100%;
    /* å¡«æ»¡çˆ¶å®¹å™¨é«˜åº¦ */
    padding: 10px 0;
    font-size: 13px;
}

/* --- Toast æç¤ºæ ·å¼ --- */
#toast-container {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    pointer-events: none;
}

.toast {
    background: var(--ui-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--ui-border);
    color: var(--select-color);
    padding: 10px 20px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    box-shadow: var(--ui-shadow);
    margin-top: 10px;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    pointer-events: auto;
    display: flex;
    align-items: center;
    gap: 12px;
}

.toast.show {
    opacity: 1;
    transform: translateY(0);
}


.toast-actions {
    display: flex;
    gap: 8px;
    margin-left: 8px;
    border-left: 1px solid var(--dot-color);
    padding-left: 12px;
}

.btn-toast {
    background: transparent;
    border: 1px solid var(--select-color);
    color: var(--select-color);
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-toast:hover {
    background: var(--select-color);
    color: white;
}

button.primary {
    width: 100%;
    padding: 10px;
    cursor: pointer;
    background: var(--select-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 13px;
    transition: transform 0.1s, opacity 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

button.primary:active {
    transform: scale(0.98);
}

button.primary:hover {
    opacity: 0.9;
}

button.secondary {
    flex: 1;
    padding: 8px;
    cursor: pointer;
    background: transparent;
    color: var(--ui-text);
    border: 1px solid var(--dot-color);
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
}

button.secondary:hover {
    background: var(--ui-hover-bg);
    border-color: var(--ui-text-dim);
}

button.btn-danger {
    background: var(--c-danger);
    color: var(--c-danger-text);
    border-color: var(--c-danger);
}

button.btn-danger:hover {
    background: #dc2626;
    opacity: 1;
}

/* å¸®åŠ©èœå• */
#help-modal {
    position: absolute;
    top: 52px;
    right: 0;
    width: 280px;
    background: var(--ui-bg);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid var(--ui-border);
    box-shadow: var(--ui-shadow);
    border-radius: 14px;
    padding: 16px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-8px) scale(0.98);
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 2000;
    text-align: left;
    transform-origin: top right;
}

#help-modal.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

.help-row {
    margin-bottom: 10px;
    font-size: 13px;
    color: var(--ui-text);
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    border-bottom: 1px dashed var(--dot-color);
    padding-bottom: 6px;
}

.help-row:last-of-type {
    border-bottom: none;
    margin-bottom: 16px;
}

.help-desc {
    opacity: 0.75;
    font-weight: 500;
}

.help-keys {
    font-family: monospace;
    font-size: 12px;
    background: var(--ui-hover-bg);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--ui-text);
}

/* GitHub Link */
.github-link {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
    font-size: 13px;
    color: var(--ui-text);
    background: var(--ui-hover-bg);
    padding: 8px;
    border-radius: 8px;
    transition: background 0.2s;
    margin-top: 8px;
    font-weight: 500;
}

.github-link:hover {
    background: rgba(0, 0, 0, 0.08);
}

[data-theme="dark"] .github-link:hover {
    background: rgba(255, 255, 255, 0.15);
}

/* --- Canvas Elements --- */
#canvas-container {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    overflow: hidden;
    touch-action: none; 
}

#world {
    position: absolute;
    top: 0;
    left: 0;
    transform-origin: 0 0;
}

.node {
    position: absolute;
    border: 1px solid transparent;
    border-radius: 12px;
    padding: 12px 20px;
    min-width: 60px;
    text-align: center;
    box-shadow: var(--node-shadow);
    font-size: 14px;
    font-weight: 500;
    cursor: grab;
    white-space: nowrap;
    z-index: 10;
    transition: box-shadow 0.2s, transform 0.1s;
}

.node:hover {
    box-shadow: var(--node-shadow-hover);
}

.node.selected {
    box-shadow: 0 0 0 2px var(--select-color), /* âœ¨ ç”¨è¿™ä¸€è¡Œä»£æ›¿ border */
                0 0 0 4px rgba(99, 102, 241, 0.2), 
                var(--node-shadow) !important;
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2), var(--node-shadow) !important;
    z-index: 50;
}

.node.editing {
    cursor: text;
    border-color: var(--select-color) !important;
    outline: none;
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
    user-select: text;
    -webkit-user-select: text;
    /* ç¼–è¾‘æ—¶ç¦ç”¨è¿‡æ¸¡ï¼Œé˜²æ­¢å†…å®¹å˜åŒ–å¯¼è‡´çš„ä½ç§»/é˜´å½±åŠ¨ç”»å¹²æ‰°æ‰“å­— */
    transition: none !important; 
    /* ä¿æŒå­—ä½“ç¨³å®š */
    font-variant-ligatures: none;
}

.node.c-white {
    background: var(--c-white-bg);
    border-color: var(--c-white-border);
    color: var(--c-white-text);
}

.node.c-red {
    background: var(--c-red-bg);
    border-color: var(--c-red-border);
    color: var(--c-red-text);
}

.node.c-yellow {
    background: var(--c-yellow-bg);
    border-color: var(--c-yellow-border);
    color: var(--c-yellow-text);
}

.node.c-green {
    background: var(--c-green-bg);
    border-color: var(--c-green-border);
    color: var(--c-green-text);
}

.node.c-blue {
    background: var(--c-blue-bg);
    border-color: var(--c-blue-border);
    color: var(--c-blue-text);
}

.node.c-orange {
    background: var(--c-orange-bg);
    border-color: var(--c-orange-border);
    color: var(--c-orange-text);
}

.node.c-purple {
    background: var(--c-purple-bg);
    border-color: var(--c-purple-border);
    color: var(--c-purple-text);
}

.node.c-pink {
    background: var(--c-pink-bg);
    border-color: var(--c-pink-border);
    color: var(--c-pink-text);
}

.node.c-cyan {
    background: var(--c-cyan-bg);
    border-color: var(--c-cyan-border);
    color: var(--c-cyan-text);
}

.group {
    position: absolute;
    border: 2px dashed var(--group-border);
    background: var(--group-bg);
    border-radius: 20px;
    z-index: 5;
    pointer-events: all;
    transition: background 0.2s;
}

.group.selected {
    border-color: var(--select-color);
    background: rgba(99, 102, 241, 0.15);
}

svg.connections {
    position: absolute;
    top: 0;
    left: 0;
    overflow: visible;
    z-index: 1;
    pointer-events: none;
}

line.link {
    stroke: var(--link-color);
    stroke-width: 2;
    opacity: 0.5;
}

#selection-box {
    position: absolute;
    border: 1px solid var(--select-color);
    background: var(--ui-selection-bg);
    display: none;
    z-index: 999;
    border-radius: 4px;
    pointer-events: none;
}

/* å¤ç”¨å¸®åŠ©é¢æ¿çš„æ ·å¼ï¼Œå¢åŠ ä¸€äº›è®¾ç½®ä¸“ç”¨çš„ */
.help-modal-style {
    position: absolute;
    top: 52px;
    right: 0;
    width: 220px;
    background: var(--ui-bg);
    backdrop-filter: blur(16px);
    border: 1px solid var(--ui-border);
    box-shadow: var(--ui-shadow);
    border-radius: 14px;
    padding: 12px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-8px) scale(0.98);
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 2000;
    transform-origin: top right;
}

#settings-modal.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

.settings-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    color: var(--ui-text);
    padding: 4px 0;
}

/* ç®€å•çš„å¤é€‰æ¡†æ ·å¼ */
input[type="checkbox"] {
    cursor: pointer;
    width: 16px;
    height: 16px;
    accent-color: var(--select-color);
}

body.hide-grid {
    background-image: none !important;
}

/* --- æ‰‹å†™é£æ ¼å…¨å±€æ ·å¼ --- */
.hand-drawn-style {
    /* è‹±æ–‡ä½¿ç”¨ Architects Daughterï¼Œä¸­æ–‡è‡ªåŠ¨å›é€€åˆ° LXGW WenKai Mono TC */
    font-family: 'Architects Daughter', 'LXGW WenKai Mono TC', cursive !important;
    font-display: swap;
}

/* é…åˆæ‰‹å†™å­—ä½“ï¼ŒèŠ‚ç‚¹å¯ä»¥ç¨å¾®å¢åŠ ä¸€ç‚¹ç‚¹å€¾æ–œæ„Ÿ */
.hand-drawn-style .node {
    letter-spacing: 0.05em;
    /* ç»™è¾¹æ¡†å¢åŠ ä¸€ç‚¹ç‚¹ä¸è§„åˆ™åœ†è§’ï¼Œå¢åŠ â€œæ‰‹ç»˜æ„Ÿâ€ */
    border-radius: 255px 15px 225px 15px/15px 225px 15px 255px !important;
}

/* æŒ‰é’®ä¹ŸåŒæ­¥å˜æ¢å­—ä½“ */
.hand-drawn-style button,
.hand-drawn-style textarea {
    font-family: 'Architects Daughter', 'LXGW WenKai Mono TC', cursive !important;
}

/* --- ç©ºçŠ¶æ€å¼•å¯¼æ ·å¼ --- */
.empty-state {
    position: absolute;
    top: 70px;
    /* ä½äº UI é¢æ¿ä¸‹æ–¹ */
    left: 40px;
    z-index: 0;
    /* æ”¾åœ¨èŠ‚ç‚¹åº•å±‚ */
    color: var(--select-color);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    display: none;
    /* é»˜è®¤éšè—ï¼Œç”± JS æ§åˆ¶ */
}

/* å½“ç”»å¸ƒä¸ºç©ºæ—¶æ˜¾ç¤º */
body.is-empty .empty-state {
    display: block;
    opacity: 0.6;
}

.empty-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.arrow-svg {
    width: 80px;
    height: 80px;
    transform: rotate(-10deg);
    /* å¢åŠ ä¸€ä¸ªå¾®å¼±çš„å‘¼å¸åŠ¨ç”» */
    animation: arrow-bob 2s infinite ease-in-out;
}

.empty-state p {
    font-size: 16px;
    font-weight: 500;
    margin: 0;
    white-space: nowrap;
}

/* æ‰‹ç»˜é£æ ¼é€‚é… */
.hand-drawn-style .empty-state p {
    font-family: 'Architects Daughter', 'LXGW WenKai Mono TC', cursive !important;
    font-size: 18px;
}

@keyframes arrow-bob {

    0%,
    100% {
        transform: translate(0, 0) rotate(-10deg);
    }

    50% {
        transform: translate(-5px, -5px) rotate(-15deg);
    }
}

/* --- åŠ¨ä½œå †å å®¹å™¨ --- */
.action-stack {
    position: relative;
    height: 38px;
    overflow: hidden;
    perspective: 1000px;
}

.stack-front,
.stack-back {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    gap: 10px;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

/* åˆå§‹çŠ¶æ€ï¼šæ­£é¢åœ¨åœºï¼Œåé¢åœ¨ä¸‹æ–¹æ—‹è½¬ */
.stack-back {
    transform: translateY(100%) rotateX(-90deg);
    opacity: 0;
    pointer-events: none;
}

/* æ¿€æ´»å¯¼å‡ºçŠ¶æ€ */
.action-stack.is-exporting .stack-front {
    transform: translateY(-100%) rotateX(90deg);
    opacity: 0;
    pointer-events: none;
}

.action-stack.is-exporting .stack-back {
    transform: translateY(0) rotateX(0deg);
    opacity: 1;
    pointer-events: auto;
}

/* --- é“¾æ¥èŠ‚ç‚¹ä¸“ç”¨æ ·å¼ --- */
.node.is-link {
    font-size: 12px; /* å­—ä½“å˜å° */
    padding: 8px 16px; /* ç¨å¾®å‡å°å†…è¾¹è·è®©å®ƒæ›´ç´§å‡‘ */
    max-width: 240px; /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œæ‹’ç»å¤§èƒ¶å›Š */
    color: var(--select-color); /* ä½¿ç”¨ä¸»é¢˜è‰²ï¼Œæˆ–è€…ä¿æŒé»˜è®¤è‰² */
}

/* é“¾æ¥æ–‡æœ¬å®¹å™¨ï¼šè´Ÿè´£æˆªæ–­é•¿ç½‘å€ */
.node-text {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-decoration: underline; /* ä¸‹åˆ’çº¿ */
    text-decoration-color: rgba(0, 0, 0, 0.2);
    pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ° nodeï¼Œä¿è¯æ‹–æ‹½ä½“éªŒ */
}

/* è·³è½¬æŒ‰é’®ï¼šæ‚¬æµ®åœ¨å³ä¾§ */
.link-btn {
    position: absolute;
    right: -32px; /* ç§»å‡ºèŠ‚ç‚¹å¤–éƒ¨ */
    top: 50%;
    transform: translateY(-50%) scale(0.8);
    width: 24px;
    height: 24px;
    
    background: var(--bg-color); /* é®æŒ¡èƒŒåçš„ç½‘æ ¼çº¿ */
    border: 1px solid var(--select-color);
    border-radius: 50%;
    
    display: flex;
    align-items: center;
    justify-content: center;
    
    font-size: 12px;
    color: var(--select-color);
    cursor: pointer;
    
    opacity: 0;
    pointer-events: none;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    z-index: 100;
}

/* åªæœ‰å½“èŠ‚ç‚¹è¢«é€‰ä¸­æ—¶ï¼ŒæŒ‰é’®æ‰å‡ºç° */
.node.selected .link-btn {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(-50%) scale(1);
}

.link-btn:hover {
    background: var(--select-color);
    color: white;
    transform: translateY(-50%) scale(1.1);
}

/* æ‰‹å†™æ¨¡å¼é€‚é…ï¼šä¸‹åˆ’çº¿æ”¹ä¸ºæ³¢æµªçº¿å¯èƒ½æ›´æœ‰è¶£ï¼Œæˆ–è€…ä¿æŒç®€å• */
.hand-drawn-style .node-text {
    text-decoration-style: solid; 
}

.help-footer-row {
    display: flex;
    gap: 8px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed var(--dot-color);
}

.help-action-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    font-size: 12px;
    color: var(--ui-text);
    background: var(--ui-hover-bg);
    padding: 8px 0;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
    font-family: inherit; /* ç»§æ‰¿æ‰‹å†™å­—ä½“ */
}

.help-action-btn:hover {
    background: rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
}
[data-theme="dark"] .help-action-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

/* --- About Overlay & Card --- */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(4px);
    z-index: 3000;
    display: flex;
    align-items: center;
    justify-content: center;
    
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}

.modal-overlay.show {
    opacity: 1;
    pointer-events: auto;
}

#about-card {
    width: 320px;
    background: var(--ui-bg);
    border: 1px solid var(--ui-border);
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    border-radius: 24px;
    padding: 32px 24px;
    text-align: center;
    position: relative;
    transform: scale(0.95) translateY(10px);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

.modal-overlay.show #about-card {
    transform: scale(1) translateY(0);
}

.about-logo { font-size: 48px; margin-bottom: 8px; }
.about-title { font-size: 24px; font-weight: 800; color: var(--select-color); margin-bottom: 4px; }
.about-version { font-size: 12px; color: var(--ui-text-dim); margin-bottom: 24px; font-family: monospace; }

.about-desc {
    font-size: 14px;
    line-height: 1.6;
    color: var(--ui-text);
    margin-bottom: 24px;
    opacity: 0.9;
}

.about-stats {
    font-size: 12px;
    color: var(--ui-text-dim);
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.heart-icon { color: var(--c-danger); animation: heartbeat 1.5s infinite; }

.about-links {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.about-link-item {
    padding: 8px 16px;
    border-radius: 20px;
    background: var(--ui-hover-bg);
    color: var(--ui-text);
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    transition: all 0.2s;
}

.about-link-item:hover {
    background: var(--select-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37, 130, 146, 0.2);
}

#btn-close-about {
    position: absolute;
    top: 16px; right: 16px;
    background: transparent; border: none;
    color: var(--ui-text-dim);
    cursor: pointer;
    font-size: 18px;
    padding: 4px;
    border-radius: 50%;
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
}
#btn-close-about:hover { background: var(--ui-hover-bg); color: var(--ui-text); }

@keyframes heartbeat {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

.about-title { 
    font-size: 24px; 
    font-weight: 800; 
    color: var(--select-color); 
    margin-bottom: 4px;
    font-family: inherit; /* å…³é”®ä¿®æ”¹ */
}

/* Star å¼•å¯¼æŒ‰é’® */
.about-stars {
    margin-bottom: 24px;
    display: flex;
    justify-content: center;
}

.btn-star {
    display: flex;
    align-items: center;
    padding: 8px 16px;
    background: var(--ui-bg);
    border: 1px solid var(--ui-border);
    border-radius: 8px;
    color: var(--ui-text);
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    transition: all 0.2s;
}

.btn-star:hover {
    background: #fffbeb; /* ææ·¡çš„é»„è‰²èƒŒæ™¯ */
    border-color: #fcd34d;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
}

[data-theme="dark"] .btn-star:hover {
    background: #422006;
    border-color: #f59e0b;
}

/* åšå®¢é“¾æ¥æ ·å¼ */
.about-link-item {
    font-size: 13px;
    color: var(--ui-text-dim); /* ä½è°ƒå¤„ç† */
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 6px;
    transition: color 0.2s;
}

.about-link-item:hover {
    color: var(--select-color);
    background: var(--ui-hover-bg);
}

/* --- æ‹–æ‹½å¯¼å…¥è§†è§‰åé¦ˆ --- */
#canvas-container.drag-over {
    outline: 3px dashed var(--select-color);
    outline-offset: -10px;
    background-color: var(--ui-selection-bg);
    transition: all 0.2s ease;
}

/* åœ¨æ‹–æ‹½æ—¶ç¦ç”¨å®¹å™¨å†…å…ƒç´ çš„æŒ‡é’ˆäº‹ä»¶ï¼Œé˜²æ­¢å¹²æ‰° */
#canvas-container.drag-over * {
    pointer-events: none;
}
/* --- Spotlight Layer --- */
#spotlight-layer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999; /* å¿…é¡»åœ¨æœ€é¡¶å±‚ï¼Œè¦†ç›– UI */
    pointer-events: none; /* å…³é”®ï¼šç¡®ä¿å…‰åœˆä¸æŒ¡ä½é¼ æ ‡ç‚¹å‡»äº‹ä»¶ */
    opacity: 0;
    transition: opacity 0.3s ease; /* å¼€å¯/å…³é—­æ—¶çš„æ·¡å…¥æ·¡å‡º */
    
    /* é»˜è®¤èƒŒæ™¯ï¼šä½¿ç”¨å˜é‡æ§åˆ¶åæ ‡ */
    background: radial-gradient(
        circle 120px at var(--mouse-x, 50%) var(--mouse-y, 50%), 
        rgba(0, 0, 0, 0) 0%, 
        rgba(0, 0, 0, 0) 80%, 
        rgba(0, 0, 0, 0.45) 100%
    );
}

/* æ¿€æ´»çŠ¶æ€ */
body.spotlight-active #spotlight-layer {
    opacity: 1;
}

/* å¯ä»¥åœ¨æ¿€æ´»æ—¶è®©èƒŒæ™¯ç½‘æ ¼æ·¡å‡ºï¼Œè¿›ä¸€æ­¥å¢å¼ºå¯¹æ¯” */
body.spotlight-active #canvas-container {
    filter: saturate(0.8);
    transition: filter 0.3s;
}

.node {
    /* ä¹‹å‰çš„ text-align: center; white-space: nowrap; ä¼šè¦†ç›–è¿™é‡Œ */
    /* æˆ‘ä»¬éœ€è¦ç¡®ä¿é»˜è®¤èŠ‚ç‚¹æ˜¯å±…ä¸­çš„ï¼Œä½†å¯ä»¥è¢«è¦†ç›– */
    text-align: center;
    white-space: nowrap;
    line-height: 1.2;
}

/* å½“èŠ‚ç‚¹å†…æœ‰ <br> æ ‡ç­¾æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ’‘å¼€å¹¶æ¢è¡Œ */
/* ä¸ºäº†è®©å¤šè¡Œæ–‡æœ¬å·¦å¯¹é½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ‰ todo æˆ– <br> æ—¶æ”¹å˜å¯¹é½æ–¹å¼ */
.node:has(.todo-item, br) {
    text-align: left;
}

/* 2. Todo-list å®¹å™¨ (ç°åœ¨æ˜¯ span) */
.node .todo-item {
    display: inline-flex;
    align-items: center;
    vertical-align: top; /* âœ¨ æ”¹ä¸º top æˆ– middleï¼Œé˜²æ­¢åŸºçº¿å¯¹é½å¯¼è‡´çš„æ’‘å¼€ */
    line-height: 1;      /* âœ¨ ç¡®ä¿å®ƒå†…éƒ¨ä¸äº§ç”Ÿé¢å¤–çš„è¡Œé—´è· */
    transition: all 0.2s;
}

/* 4. Todo-list çš„æ–‡æœ¬æ ‡ç­¾ (æ— å˜åŒ–) */
.node .todo-item label {
    transition: all 0.2s;
}

/* 5. å·²å®ŒæˆçŠ¶æ€çš„æ ·å¼ (æ— å˜åŒ–) */
.node .todo-item.checked label {
    text-decoration: line-through;
    opacity: 0.6;
}
.node .todo-checkbox-wrapper {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    margin-left: -8px;
    margin-right: 6px;
    
    /* âœ¨ ä¿®æ”¹è¿™é‡Œ âœ¨ */
    padding: 0 2px;     /* å‚ç›´ padding æ”¹ä¸º 0ï¼Œåªä¿ç•™æ°´å¹³ padding */
    height: 16px;       /* ç»™ä¸€ä¸ªå›ºå®šçš„å¾®å°é«˜åº¦ */
    
    border-radius: 4px;
    transition: background-color 0.2s;
}

/* é¼ æ ‡æ‚¬æµ®æ—¶ç»™ä¸€ç‚¹åé¦ˆ */
.node .todo-checkbox-wrapper:hover {
    background-color: var(--ui-hover-bg);
}


/* 3. Todo-list çš„ Checkbox (ç°åœ¨åªè´Ÿè´£æ˜¾ç¤º) */
.node .todo-item input[type="checkbox"] {
    width: 15px;
    height: 15px;
    flex-shrink: 0;
    accent-color: var(--select-color);
    /* margin-right: 8px; <-- ç§»é™¤ */
    /* cursor: pointer;   <-- ç§»é™¤ */
    pointer-events: none; /* âœ¨ å…³é”®ï¼šè®©ç‚¹å‡»ç©¿é€å®ƒï¼Œåˆ°è¾¾çˆ¶çº§çš„ wrapper */
}

line.link {
    stroke: var(--link-color);
    stroke-width: 1.5; /* âœ¨ æ”¹ä¸º 1.5pxï¼Œæ›´çº¤ç»† */
    opacity: 0.35;      /* âœ¨ é™ä½é»˜è®¤é€æ˜åº¦ï¼Œè®©å®ƒæ›´â€œå“‘â€ */
    transition: all 0.2s ease-in-out; /* âœ¨ æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
}

.node:has(.todo-item) {
    padding-left: 12px; /* ä»é»˜è®¤çš„ 20px ç¼©å°åˆ° 12px */
}

body[data-mode="embed"] #ui-layer {
    display: none !important;
}

#btn-open-full {
    position: fixed;
    bottom: 16px;
    right: 16px;
    z-index: 1000;
    width: 32px;
    height: 32px;
    background: var(--ui-bg);
    border: 1px solid var(--ui-border);
    border-radius: 8px;
    display: none; /* é»˜è®¤éšè— */
    align-items: center;
    justify-content: center;
    color: var(--ui-text-dim);
    transition: all 0.2s;
    text-decoration: none;
}
body[data-mode="embed"] #btn-open-full {
    display: flex; /* ä»…åœ¨åµŒå…¥æ¨¡å¼æ˜¾ç¤º */
}
#btn-open-full:hover {
    color: var(--select-color);
    background: var(--c-white-bg);
    transform: scale(1.1);
}
/* --- åµŒå…¥æ¨¡å¼é¡µè„šå®¹å™¨ --- */
#embed-footer {
    position: fixed !important;
    bottom: 20px !important;
    right: 20px !important;
    
    /* æ ¸å¿ƒï¼šå¼ºåˆ¶æ°´å¹³æ’åˆ— */
    display: none; 
    flex-direction: row !important; 
    align-items: center !important;
    gap: 10px !important;
    
    z-index: 99999;
    pointer-events: auto;
}

/* æ¿€æ´»æ˜¾ç¤º */
body[data-mode="embed"] #embed-footer {
    display: flex !important;
}

/* --- ç»Ÿä¸€æŒ‰é’®æ ·å¼ (é‡ç½®æ‰€æœ‰å¹²æ‰°å±æ€§) --- */
#btn-info-embed, 
#btn-open-full {
    /* å½»åº•é‡ç½®å®šä½ï¼Œäº¤ç»™ Flex ç®¡ç† */
    position: relative !important; 
    top: auto !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    margin: 0 !important;
    
    width: 34px !important;
    height: 34px !important;
    
    background: var(--ui-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--ui-border);
    border-radius: 10px;
    
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    
    color: var(--ui-text-dim);
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    transition: all 0.2s ease;
    text-decoration: none;
}

#btn-info-embed:hover, 
#btn-open-full:hover {
    color: var(--select-color);
    background: var(--c-white-bg);
    transform: translateY(-2px);
    border-color: var(--select-color);
}

/* --- ä¿¡æ¯å¡ç‰‡ï¼šç»å¯¹å®šä½åœ¨æŒ‰é’®ä¸Šæ–¹ï¼Œä¸å‚ä¸ Flex æ’ç‰ˆ --- */
#embed-info-card {
    position: absolute !important;
    bottom: 46px !important; /* åˆšå¥½åœ¨æŒ‰é’®ä¸Šæ–¹ */
    right: 0 !important;
    
    width: 220px;
    padding: 14px;
    background: var(--ui-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--ui-border);
    border-radius: 14px;
    
    font-size: 13px;
    line-height: 1.6;
    color: var(--ui-text);
    box-shadow: var(--ui-shadow);
    
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px) scale(0.95);
    transform-origin: bottom right;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 100000;
}

/* æ‚¬æµ®é€»è¾‘ */
#btn-info-embed:hover ~ #embed-info-card {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}